apiVersion: v1
kind: ServiceAccount
metadata:
  name: databricks-service
  namespace: default
  labels:
    app: databricks-service
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: databricks-service-identity
  namespace: default
  annotations:
    # Azure managed identity annotation (for OIDC-based pod identity)
    azure.workload.identity/client-id: "your-managed-identity-client-id"
  labels:
    app: databricks-service
---
# Pod Identity Binding for workload identity federation
apiVersion: aadpodidentity.k8s.io/v1
kind: AzureIdentity
metadata:
  name: databricks-service-identity
  namespace: default
spec:
  type: 0  # User-assigned managed identity
  resourceID: /subscriptions/{subscription-id}/resourcegroups/{resource-group}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identity-name}
  clientID: "your-managed-identity-client-id"
---
apiVersion: aadpodidentity.k8s.io/v1
kind: AzureIdentityBinding
metadata:
  name: databricks-service-identity-binding
  namespace: default
spec:
  azureIdentity: databricks-service-identity
  selector: databricks-service
